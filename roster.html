<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roster – Redline Racing Alliance</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>

    <header class="site-header">
      <div class="brand">
        <img src="rra_logo.png" alt="Redline Racing Alliance logo" class="logo">
        <div class="brand-text">
          <h1>Redline Racing Alliance</h1>
          <p class="tagline">NASCAR ’25 PC Racing League</p>
        </div>
      </div>

      <nav>
        <ul class="nav-list">
          <li><a href="index.html">Home</a></li>
          <li><a href="about.html">About</a></li>
          <li><a href="schedule.html">Schedule</a></li>
          <li><a href="signup.html">Sign&nbsp;Up</a></li>
          <li><a href="roster.html">Roster</a></li>
          <li><a href="teams.html">Teams</a></li>
          <li><a href="rules.html">Rules</a></li>
          <li><a href="standings.html">Standings</a></li>
          <li><a href="contact.html">Contact</a></li>
        </ul>
      </nav>

    </header>

    <main class="content">
      <h2 class="page-title">Driver Roster</h2>
      <section class="card">
        <p>
          This area is under construction and will be dynamically updated once registrations go live!
        </p>
        <div class="table-wrapper">
      
        </div>
      </section>
    </main>

    <footer class="site-footer">
      &copy; 2025 Redline Racing Alliance. This is a fan-made league and is not officially affiliated with NASCAR or any game developer.
    </footer>
<script>
  // 1. Put your published CSV link here:
  const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vS3L8lLjAnWpwOB4bXnx-i7XwYYTiYquiTWTmxTepyrP7oUEnEPi1vniKNOLBCU6-8WmTAk0kS7rqOj/pub?gid=685554557&single=true&output=csv";

  async function loadRoster() {
    try {
      const response = await fetch(SHEET_CSV_URL);
      const csvText = await response.text();

      const lines = csvText.trim().split("\n");
      if (lines.length < 2) {
        console.warn("No data rows found in sheet.");
        return;
      }

      // Simple CSV split (works fine as long as fields don't contain commas)
      const headers = lines[0].split(",").map(h => h.trim());
      const rows = lines.slice(1).map(line => line.split(",").map(c => c.trim()));

      // Find important columns
      const nameIndex = headers.findIndex(h =>
        /steam name/i.test(h) || /in-game tag/i.test(h) || /driver name/i.test(h)
      );

      const verifiedIndex = headers.findIndex(h =>
        /verified/i.test(h)
      );

      if (nameIndex === -1) {
        console.error("Could not find a name column in the sheet headers:", headers);
        return;
      }

      // Any header that looks like a series/number column
      const seriesIndexes = [];
      headers.forEach((h, idx) => {
        if (idx === nameIndex || idx === verifiedIndex) return;
        const lower = h.toLowerCase();
        if (lower.includes("#") || lower.includes("number") || lower.includes("car")) {
          seriesIndexes.push(idx);
        }
      });

      if (seriesIndexes.length === 0) {
        console.warn("No series/number columns found. Check your header names.");
      }

      // Filter to verified rows only
      const verifiedRows = rows.filter(cells => {
        if (verifiedIndex === -1) {
          // If there's no Verified column, show everyone
          return true;
        }
        const value = (cells[verifiedIndex] || "").trim();
        return value !== "";
      });

      // Stop if nothing to show
      if (verifiedRows.length === 0) {
        console.warn("No verified drivers found.");
        return;
      }

      // Build the table
      const tableWrapper = document.querySelector(".table-wrapper");
      if (!tableWrapper) return;

      const table = document.createElement("table");

      // Table head
      const thead = document.createElement("thead");
      const headerRow = document.createElement("tr");

      const nameTh = document.createElement("th");
      nameTh.textContent = "Driver";
      headerRow.appendChild(nameTh);

      seriesIndexes.forEach(idx => {
        const th = document.createElement("th");
        th.textContent = headers[idx];
        headerRow.appendChild(th);
      });

      thead.appendChild(headerRow);
      table.appendChild(thead);

      // Table body
      const tbody = document.createElement("tbody");

      verifiedRows.forEach(cells => {
        const tr = document.createElement("tr");

        const nameTd = document.createElement("td");
        nameTd.textContent = cells[nameIndex] || "";
        tr.appendChild(nameTd);

        seriesIndexes.forEach(idx => {
          const td = document.createElement("td");
          td.textContent = cells[idx] || "";
          tr.appendChild(td);
        });

        tbody.appendChild(tr);
      });

      table.appendChild(tbody);

      // Clear whatever was in the wrapper and insert the table
      tableWrapper.innerHTML = "";
      tableWrapper.appendChild(table);
    } catch (err) {
      console.error("Error loading roster:", err);
    }
  }

  document.addEventListener("DOMContentLoaded", loadRoster);
</script>
  </body>
</html>
